---
/**
 * 首页统计信息组件
 */
import { getCollection } from 'astro:content';
import type { I18nConfig } from '../../config/i18n';
import { defaultI18nConfig } from '../../config/i18n';
import { i18nConfig as virtualI18nConfig } from 'virtual:astro-blog-i18n';
import { getLocaleFromPath, getLocaleConfig, filterPostsByLocale } from '../../utils/i18n';

export interface Props {
  i18nConfig?: I18nConfig;
}

const { i18nConfig = virtualI18nConfig || defaultI18nConfig } = Astro.props;

// Get current locale from URL
const currentLocale = getLocaleFromPath(Astro.url.pathname, i18nConfig);
const localeConfig = getLocaleConfig(currentLocale, i18nConfig);
const ui = localeConfig.ui;

const allPosts = await getCollection('posts');
const publishedPosts = allPosts.filter(post => !post.data.draft);

// Filter posts by current locale
const localePosts = filterPostsByLocale(publishedPosts, currentLocale, i18nConfig);

const totalPosts = localePosts.length;
const allTags = new Set(localePosts.flatMap(post => post.data.tags || []));
const allCategories = new Set(localePosts.flatMap(post => post.data.categories || []));
const totalTags = allTags.size;
const totalCategories = allCategories.size;
---

<section class="mb-16">
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
    <div class="card text-center">
      <div class="text-3xl font-bold text-primary-500 mb-2">
        {totalPosts}
      </div>
      <div class="text-sm text-slate-600 dark:text-slate-400">
        {ui.posts}
      </div>
    </div>
    <div class="card text-center">
      <div class="text-3xl font-bold text-primary-500 mb-2">
        {totalTags}
      </div>
      <div class="text-sm text-slate-600 dark:text-slate-400">
        {ui.tags}
      </div>
    </div>
    <div class="card text-center">
      <div class="text-3xl font-bold text-primary-500 mb-2">
        {totalCategories}
      </div>
      <div class="text-sm text-slate-600 dark:text-slate-400">
        {ui.categories}
      </div>
    </div>
  </div>
</section>
